<!DOCTYPE html>
<html>
<head>
    <title>Saudi Code RAG QA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #2c3e50;
        }
        form {
            margin-bottom: 20px;
        }
        input[type="text"] {
            width: 300px;
            padding: 8px;
            margin-bottom: 10px;
        }
        input[type="file"] {
            margin-top: 10px;
        }
        input[type="submit"] {
            padding: 8px 16px;
        }
        .image-preview {
            margin-top: 20px;
        }
        table {
            border-collapse: collapse;
            margin-top: 20px;
            width: 100%;
            background: #fff;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background: #2c3e50;
            color: white;
        }
        .status-passed { color: green; font-weight: bold; }
        .status-partial { color: orange; font-weight: bold; }
        .status-not { color: red; font-weight: bold; }
        .status-unmeasurable { color: gray; font-weight: bold; }
        .issue-text { margin-top: 5px; font-size: 14px; color: #444; }
    </style>
</head>
<body>
    <h1>Saudi Code RAG QA</h1>

    <form method="post" enctype="multipart/form-data">
        <label for="question">Text Question:</label><br>
        <input type="text" name="question" id="question" placeholder="Enter your question here"><br>

        <label for="image">Or Upload an Image:</label><br>
        <input type="file" name="image" id="image"><br><br>

        <input type="submit" value="Submit">
    </form>

    {% if question %}
        <h3>Question:</h3>
        <p>{{ question }}</p>
    {% endif %}

    {% if image_filename %}
        <div class="image-preview">
            <h3>Uploaded Image:</h3>
            <img src="{{ url_for('static', filename='uploads/' + image_filename) }}" width="400" alt="Uploaded Image">
        </div>
    {% endif %}

    {% if structured_results %}
    <h3>Inspection Results:</h3>
    {% if structured_results|length > 0 %}
        <table>
            <tr>
                <th>Item</th>
                <th>Status</th>
                <th>Notes / SBC Reference</th>
            </tr>
            {% for row in structured_results %}
            <tr>
                <td>{{ row.item }}</td>
                <td class="
                    {% if 'Passed' in row.status %}status-passed
                    {% elif 'Partial' in row.status %}status-partial
                    {% elif 'Not passed' in row.status %}status-not
                    {% elif 'Unmeasurable' in row.status %}status-unmeasurable
                    {% endif %}
                ">
                    {{ row.status }}
                </td>
                <td><div class="issue-text">{{ row.notes }}</div></td>
            </tr>
            {% endfor %}
        </table>
        <a href="{{ url_for('download_pdf', filename=image_filename) }}">
            <button type="button">⬇ Download PDF (English)</button>
        </a>
    {% else %}
        <p style="color:red; font-weight:bold;">⚠️ No items found in analysis.</p>
    {% endif %}
{% endif %}

    {% if answer and not structured_results %}
        <h3>Answer:</h3>
        <pre>{{ answer }}</pre>
    {% endif %}
</body>
</html>
